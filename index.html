<!DOCTYPE html>
<html>
    <head>
        <title>RegExpCalJs</title>
        <style>
table td {
    border: 1px solid black;
}            

#inputtext {
    height: 30px;
    width: 100%;
}
        </style><script>
const mapping = {
    "$s": {value: "(?<s>.*)", doc: "Summary"},
    "$b": {value: "(?<bd>\\d\\d)\\.(?<bm>\\d\\d)\\.(?<by>\\d\\d\\d\\d)", doc:"Begin date"}
}

class Event {
    summary = ""

    set beginDate(val) {
        this._beginDate = val;
        if(!this._endDate) {
            this._endDate = val;
        }
    } 

    get beginDate() {
        return this._beginDate;
    }
    get endDate() {
        return this._endDate;
    }
}
function setDownload(events) {
  var link = document.getElementById("downloadlink");
  link.download = "Calendar.ics";
  link.href = "data:text/plain,CAL";
}

function printEvents(events) {
    function addCol(tr, cssclass) {
        let td = document.createElement("td");
        td.classList.add(cssclass);
        tr.appendChild(td);
        return td;
    }

    function addRow(table) {
        let tr = document.createElement("tr");
        table.appendChild(tr);
        return tr;
    }

    let table = document.getElementById("Ausgabe");
    table.replaceChildren();

    events.forEach(e => {
        let tr = addRow(table);
        addCol(tr, "eventsummary").textContent = e.summary;
        addCol(tr, "eventbegindate").textContent = e.beginDate.toLocaleDateString();
    });
}

function expand(input) {
    var output = input;
    for(key in mapping) {
        output = output.replace(key, mapping[key].value);
    }
    return output;
}

function parse() {
    let inputText = document.getElementById("inputtext").value;
    let regexinput = document.getElementById("regexpinput").value;
// $s = summary = (?<s>.*), $b = begin date = (?<b>(?<bd>\d\d)\.(?<bm>\d\d)\.(?<by>\d\d\d\d))
    let regtext = expand(regexinput);
                        
    let events = [];

    let regexp = new RegExp(regtext, "g");
    for(const match of inputText.matchAll(regtext)) {
    
    let e = new Event();
    e.summary = match.groups.s;
    e.beginDate = new Date(match.groups.by, match.groups.bm -1, match.groups.bd)
    events.push(e);
    }
    printEvents(events);
    setDownload(events);
}
        </script>
    </head>
    <body>
        <h1>RegExpCalJs</h1>
        <textarea rows="10" id="inputtext">Hi 01.01.2000
1. Weihnachten 24.12.2022</textarea>
        <button onclick="parse()">Parsen</button>
        <pre>$s = summary = (?&lt;s&gt;.*), $b = begin date = (?&lt;b&gt;(?&lt;bd&gt;\d\d)\.(?&lt;bm&gt;\d\d)\.(?&lt;by&gt;\d\d\d\d))</pre>
        <div>
            <input id="regexpinput" value="$s $b">
        </div>
        <div>
            <table>
<thead>
<tr><th>Summary</th><th>Begin Date</th></tr>
</thead>
<tbody  id="Ausgabe">

</tbody>
            </table>
        </div>
        <div>
            <a href="" id="downloadlink">Download</a>
        </div>
    </body>
</html>